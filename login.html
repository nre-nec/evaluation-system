<!doctype html>
<html lang="ar" dir="rtl">
<head>
<meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1">
<title>تسجيل الدخول | NCN</title>
<link rel="stylesheet" href="assets/style.css">
</head>
<body>
<header class="header">
  <div class="brand">
    <img src="logo.png" alt="NCN">
    <h1>نظام تقييم المقابلات <span class="badge">Interview Evaluation</span></h1>
  </div>
  <div></div>
</header>
<div class="container">
  <div class="card center">
    <p class="muted">اختر اسم المستخدم ثم أدخل كلمة المرور | Select username & enter password</p>
    <div class="grid">
      <div><label>اسم المستخدم / Username</label><select id="name" class="input"><option selected disabled>اختر اسم المستخدم</option></select></div>
      <div><label>كلمة المرور / Password</label><input type="password" id="pwd" class="input" placeholder="••••••••"></div>
    </div>
    <div class="actions" style="justify-content:center;margin-top:12px">
      <button id="loginBtn">تسجيل الدخول | Login</button>
    </div>
  </div>
  <p class="footer">© كلية الشمال للتمريض الأهلية — وحدة التطوير والجودة</p>
</div>
<script src="assets/app.js"></script>
<script>
(async ()=>{
  try{ const evals = await apiGet('evaluators'); const sel = document.getElementById('name'); evals.forEach(e=>{ const o=document.createElement('option'); o.value=e.username; o.textContent=e.username; o.dataset.role=e.role||'evaluator'; o.dataset.committee=e.committee||''; sel.appendChild(o); }); }
  catch(e){ toast('تعذر تحميل قائمة المستخدمين / Unable to load evaluators','err'); }
})();

document.getElementById('loginBtn').addEventListener('click', async ()=>{
  const u = document.getElementById('name').value;
  const p = document.getElementById('pwd').value.trim();
  if(!u||u==='اختر اسم المستخدم' || !p) return toast('يرجى اختيار اسم المستخدم وإدخال كلمة المرور','err');
  try{ const evals = await apiGet('evaluators'); const user = evals.find(x=>x.username===u && x.password===p); if(!user) return toast('بيانات الدخول غير صحيحة','err');
    saveSession({user:{username:user.username, role:user.role||'evaluator', committee:user.committee||''}});
    if(user.role==='admin') location.href='admin-dashboard.html';
    else if(user.role==='committee') location.href='committee-evaluation.html';
    else location.href='evaluation-form.html';
  }catch(e){ toast('تعذر الاتصال بالخادم','err'); }
});
</script>
</body></html>
